<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.js.secondhandauction.core.auction.repository.AuctionRepository">
    <insert id="create" parameterType="com.js.secondhandauction.core.auction.domain.Auction" useGeneratedKeys="true" keyProperty="auction_no" keyColumn="auction_no">
        insert into Auction
            (item_no, price, reg_id, reg_date)
        values
            (#{item_no}, #{price}, #{reg_id}, NOW())
    </insert>

    <select id="getMax">
        SELECT
            item_no,
            price,
            reg_id
        FROM Auction
        WHERE (item_no, price) IN (
            SELECT item_no, MAX(price)
            FROM Auction
            WHERE ITEM_NO = #{item_no}
            GROUP BY item_no
        )
    </select>

    <select id="getCount">
        select
            count(*)
        from Auction
        where
            item_no = #{item_no}
    </select>
</mapper>